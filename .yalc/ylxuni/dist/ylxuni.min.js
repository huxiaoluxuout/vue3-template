!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@/pages.json")):"function"==typeof define&&define.amd?define(["@/pages.json"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).ylxuni=t(e.pagesConfig)}(this,(function(e){"use strict";const t=new class{constructor(){this.listeners=new Map}on(e,t){if("function"!=typeof t)throw new Error(t+"必须是一个函数");this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}once(e,t){if("function"!=typeof t)throw new Error(t+"必须是一个函数");const n=(...s)=>{t(...s),this.off(e,n)};this.on(e,n)}emit(e,...t){let n,s,o;if("string"==typeof e)n=e;else{if("object"!=typeof e)throw new Error("Options必须是字符串或对象");n=e.event,s=e.handler,o=e.source}const i=this.listeners.get(n);if(i)if(s){const e=[...i].find((e=>e.name===s));e&&e({args:t,source:o})}else i.forEach((e=>e({args:t,source:o})))}off(e,t){if(t){if("function"==typeof t){const n=this.listeners.get(e);n&&n.delete(t)}}else this.listeners.set(e,new Set)}clear(){this.listeners.clear()}};class n{static platform=null;constructor(e){n.platform=e,this.onGlobal=this.handleRegisterGlobalEvent,this.emitGlobal=this.handleSendGlobal,this.emit=this.handleEmit,this.on=this.handleOn}static NAVIGATION_TYPES={NAVIGATE_TO:"navigateTo",SWITCH_TAB:"switchTab"};static eventBusSet=new Set;static defaultGlobalCallback=({args:e,source:t})=>console.log("AppEvent",{args:e,source:t});handleRegisterGlobalEvent(e=n.defaultGlobalCallback){t.on("AppEvent",e),t.on("GLOBAL_PAGES_EVENT",n.handlerListener)}static handlerListener({args:e,source:t}){let[{navigationType:s,targetPath:o,isNavigationEnabled:i,options:a,sourceName:r}]=e;const{path:l,query:c,delimiter:u}=n.parseUrl(o);n.sendTargetPage(l,t,a,r),n.handleNavigation(s,l,c,u,a,i)}static sendTargetPage(e,s,o,i){n.eventBusSet.has(e)?t.emit({event:e,source:i||s},o):t.once("CURRENT_PAGE_EVENT"+e,(()=>(n.eventBusSet.add(e),t.emit({event:e,source:i||s},o))))}static handleNavigation(e,t,s,o,i,a){if(!a)return;if(e!==n.NAVIGATION_TYPES.NAVIGATE_TO&&e!==n.NAVIGATION_TYPES.SWITCH_TAB)return void console.error(`导航路径：${JSON.stringify(n.NAVIGATION_TYPES)}`);const r=e===n.NAVIGATION_TYPES.NAVIGATE_TO?`${t}${s}${o}currentRoute=${t}`:t;n.platform[e]({url:r,fail:e=>console.error("Navigation Error:",e)})}async handleEmit({targetPath:e,options:s={},source:o=""},i=!1,a=n.NAVIGATION_TYPES.NAVIGATE_TO){const r=await n.getRoute(),l="object"==typeof s?Object.assign({fromPage:r},s):s;t.emit({event:"GLOBAL_PAGES_EVENT",source:r,handler:"handlerListener"},{navigationType:a,targetPath:e,isNavigationEnabled:i,options:l,sourceName:o})}async handleSendGlobal(e={},s=""){const o=await n.getRoute(),i="object"==typeof e?Object.assign({fromPage:o},e):e;t.emit({event:"AppEvent",source:s||o},i)}static getRoute(){const e=getCurrentPages(),t="/"+e[e.length-1].route;return Promise.resolve(t)}handleOn(e){"function"==typeof e&&n.getRoute().then((s=>{n.eventBusSet.has(s)||(n.eventBusSet.add(s),t.on(s,e),t.emit("CURRENT_PAGE_EVENT"+s))}))}static parseUrl(e){const t=e.startsWith("/")?e:"/"+e,[n,s]=t.split("?");return{path:n,query:s?"?"+s:"",delimiter:s?"&":"?"}}}
// #ifdef MP
const s=(e,t=1500,n=!1,s="none")=>{Boolean(e)&&uni.showToast({title:e,duration:t,mask:n,icon:s})},{tabBar:{list:o}={list:[]}}=e,i=(e,t={},n)=>{if(!e)return;const s=e.match(/\/?([^?]+)/)[1];if(o.map((e=>l(e.pagePath))).includes(l(s)))uni.switchTab({url:l(s),fail:function(e){console.error(e)}});else{let s=-1===e.indexOf("?")?"?":"&",o="";Object.keys(t).length&&(o=s+Object.keys(t).map((e=>`${e}=${t[e]}`)).join("&")),uni[n]({url:l((i=e,(-1!==i.lastIndexOf(".vue")?(console.warn("移除.vue"),i.replace(/\.vue$/,"")):i)+o)),success:function(e){console.log(e.errMsg)},fail:function(e){console.error("fail",e.errMsg)}})}var i},a=(e,t={})=>i(e,t,"navigateTo"),r=(e,t={})=>i(e,t,"redirectTo"),l=e=>/^\//.test(e)?e:"/"+e;return function(e){const t=e||uni;return{ylxEventBus:new n(t),ylxToast:s,ylxNavigateTo:a,ylxRedirectTo:r}}}));
