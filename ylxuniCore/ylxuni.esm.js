function e(e,t){const n=Object.prototype.toString.call(e).replace(/\[object (\w+)\]/,"$1").toLowerCase();return t?n===t:n}function t(t,n,a){e(t,"object")&&e(t.setData,"function")&&t.setData({[n]:a})}function n(e){if("object"!=typeof e||null===e)throw new TypeError("Target must be an object");return new Proxy(e,{get:(e,t,n)=>Reflect.get(e,t,n),set:(e,t,n,a)=>Reflect.set(e,t,n,a)})}function a(e=uni,t){return{ylxEventBus:new r(e),ylxNextPage:new c(e,t),ylxIntercept:new s(e,t)}}const o=new class{constructor(){this.eventListeners=new Map}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,{}),this.eventListeners.get(e)[t.name]=t}once(e,t){const n=(...a)=>{t(...a),this.off(e,n)};this.on(e,n)}emit(t,...n){let a,o,r;e(t,"string")?a=t:e(t,"object")&&(a=t.event,o=t.handler,r=t.source);const c=this.eventListeners.get(a);if(!c)return;const s={args:n,source:r};if(o){const e=c[o];e&&e(s)}else Object.values(c).forEach((e=>e(s)))}off(t,n,a){if(n){if(e(n,"function")){const e=this.eventListeners.get(t);e&&(a?Object.keys(e).forEach((t=>{delete e[t]})):delete e[n.name])}}else this.eventListeners.delete(t)}clear(){this.eventListeners.clear()}};class r{static platform=null;constructor(e){r.platform=e}static eventBusSet=new Set;static defaultGlobalCallback=()=>({});onGlobal(e=r.defaultGlobalCallback){o.on("AppEvent",e),o.on("GLOBAL_PAGES_EVENT",r.handlerListener)}static handlerListener({args:e,source:t}){let[{targetPath:n,options:a,sourceName:o}]=e;const{path:c}=function(e){const t=e.startsWith("/")?e:"/"+e,[n,a]=t.split("?");return{path:n,query:a?"?"+a:"",delimiter:a?"&":"?"}}(n);r.sendTargetPage(c,t,a,o)}static sendTargetPage(e,t,n,a){r.eventBusSet.has(e)?o.emit({event:e,source:a||t},n):o.once("CURRENT_PAGE_EVENT"+e,(()=>(r.eventBusSet.add(e),o.emit({event:e,source:a||t},n))))}async emit({targetPath:t,options:n={},source:a="",prevPage:c=!1}){const{currentRoute:s,prevPageRoute:l}=await r.getRoute();c&&l&&(t=l);const i=e(n,"object")?Object.assign({fromPage:s},n):n;return new Promise((e=>{i.thenCallback=e,o.emit({event:"GLOBAL_PAGES_EVENT",source:s,handler:"handlerListener"},{targetPath:t,options:i,sourceName:a})}))}async emitGlobal(t={},n=""){const{currentRoute:a}=await r.getRoute(),c=e(t,"object")?Object.assign({fromPage:a},t):t;return new Promise((e=>{c.thenCallback=e,o.emit({event:"AppEvent",source:n||a},c)}))}static getRoute(){const e=getCurrentPages();let t=null;e.length>=2&&(t="/"+e[e.length-2].route);const n="/"+e[e.length-1].route;return Promise.resolve({currentRoute:n,prevPageRoute:t})}on(t){e(t,"function")&&r.getRoute().then((({currentRoute:e})=>{r.eventBusSet.has(e)||r.eventBusSet.add(e),o.on(e,t),o.emit("CURRENT_PAGE_EVENT"+e)}))}off(t,{targetPath:n,del:a=!1}){e(n,"undefined")?r.getRoute().then((({currentRoute:e})=>{o.off(e,t,a)})):o.off(n,t,a)}clear(){o.clear()}}class c{static platform=null;static emptyResData=!1;static pageInfo={page:1,pageSize:10};static loadingObj={loading:!0};static dataCallback=()=>{};constructor(e,t){c.platform=e,t&&(c.loadingObj=t(c.loadingObj)),this.loadingProxyObject=n(c.loadingObj)}useNextPage(a={page:1,pageSize:10},o,r="loading"){function s(){R.page=c.pageInfo.page,R.pageSize=c.pageInfo.pageSize}function l(n){v=!0,m=!1,y=!0,u.loadingProxyObject.loading=!0,t(o,r,!0),s(),b(),e(n,"function")&&n(R),e(c.reloadCallback,"function")&&c.reloadCallback()}function i(){R.page>1&&y&&(c.emptyResData||b())}const u=this,{setFn:g,addFn:p,invokeAllFn:f}=function(){let e=[],t=[];return{addFn:(e,...n)=>{t.some((t=>t.func===e&&t.args.length===n.length))||t.push({func:e,args:n})},setFn:(t,...n)=>{e=[{func:t,args:n}]},invokeAllFn:function(){const n=t.concat(e);for(;n.length>0;){const{func:e,args:t}=n.pop();e(...t)}}}}(),h=p,d=g,b=f;e(a,"object")||(a={page:1,pageSize:10}),a.page||a.pageSize||(a={page:1,pageSize:10});let v=!1,m=!1,y=!0;c.pageInfo={...a};const R=n(a);let P=0;return{ylxMixins:{onLoad(){s()},onReachBottom(){i()},onPullDownRefresh(){l(),P=setTimeout((()=>{c.platform.stopPullDownRefresh()}),2500)}},ylxPageInfo:R,ylxReachBottom:i,ylxSetFn:d,ylxAddFn:h,ylxInvokeFn:b,ylxRefresh:l,ylxSetData:function({data:n=[],resData:a=[]}={},s=0){if(c.platform.stopPullDownRefresh(),clearTimeout(P),u.loadingProxyObject.loading=!1,t(o,r,!1),!e(n,"array"))return c.dataCallback(),a;e(n,"array")&&!e(a,"array")&&(a=[]),c.emptyResData=0===a.length,v&&(n.length=0,v=!1);let l=s>n.length+a.length;if(1===R.page)return l&&(R.page+=1),c.dataCallback(),a;if(l)return R.page+=1,c.dataCallback(),n.concat(a);if(m){y=!1;let e=(R.page-1)*R.pageSize,t=n.length-e;return n.splice(e,t,...a),c.dataCallback(),n}return m=!0,c.dataCallback(),n.concat(a)},ylxSetInv:function(e){d(e),b()},ylxSetDataCallback:function(e){"function"==typeof e&&(c.dataCallback=e)}}}}class s{static platform=null;static interceptObject={};static vue3Reactive=null;constructor(e,t){s.platform=e,s.vue3Reactive=t,this.initIntercepts({login:!1})}initIntercepts(e){let t={};s.vue3Reactive&&(t=s.vue3Reactive(e)),s.interceptObject=n(t)}static tool(t){return!e(s.interceptObject[t],"undefined")}setIntercept(e,t){s.tool(e)?s.interceptObject[e]=t:console.error(e+"未定义")}getInterceptState(e){return s.tool(e)?s.interceptObject[e]:e+"-1"}get getIntercepts(){return s.interceptObject}intercept({success:e=()=>{},fail:t=()=>{}}={},a){if(!s.tool(a))return void console.error(a+"未定义");const{createInterceptor:o}=function(e){const t=n(e);return{proxyObject:t,createInterceptor:function({onError:e,onSuccess:n},a="login"){return function(...o){t[a]?n(...o):e()}}}}(s.interceptObject);return o({onSuccess:e,onError:t},a||"login")}}export{a as default};
